# 概要
本ソフトはコマンドライン上からSlackにテキストを投稿するためのものです。  

    # トークンとチャンネルとテキストを指定して送信
    $ slackpost -T (Slackトークン) -c (チャンネル) こんにちは

    # 環境変数にトークンとチャンネルを設定することが可能
    $ export SLACK_TOKEN=(Slackトークン)
    $ export SLACK_CHANNEL=(投稿するチャンネル。例：#general)
    $ slackpost こんにちは

本ソフトは、[Slack Web API](https://api.slack.com/web)を用いて動作しています。

# できること、できないこと
## できること
- Slackに引数のテキストを送信する。
- 送信するチャンネル、ダイレクトメッセージを指定できる。
- 送信するテキストは、標準入力からも与えることができる。
- 投稿者名を指定することができる(デフォルトはトークンの持ち主のユーザ名)。
- 投稿者アイコンを指定することができる(標準の絵文字、画像のURL。デフォルトはトークンの持ち主のアイコン)。
- 送信テキストをスニペットとして指定することができる。
   - ただし、スニペットとして指定した場合、ユーザ名とアイコンはデフォルトになる。
   - ファイルタイプやファイル名を指定することができる。

## できないこと
- 画像などのメディアの送信する。
- グループに投稿する。
- ファイル名を直接指定して、中身を送信する。
   - パイプを通してテキストを指定することができるため、  
     `$ cat file.txt | slackpost`  
     とすることで解決できる。

# 導入方法
GitHubのリポジトリをクローンし、ダウンロードした実行ファイルをパスの通っているディレクトリにコピーします。  
例では、`/usr/local/bin/`に保存しているが、パスが通っていれば任意の場所で問題ありません。

    $ cd ~
    $ git clone https://github.com/sukesuke13/slackpost.git
    $ cd slackpost
    $ chmod +x slackpost
    $ sudo cp slackpost /usr/local/bin/

導入が完了したら、クローンしたリポジトリは削除して問題ありません。

    $ cd ~
    $ rm -r slackpost


# 使い方 
`-h`オプションを指定することで、ヘルプを表示することができます。  
また、`-T`オプションで、○○を指定することができる。のような説明をしますが、これは、

    $ slackpost -T xxxxxx

のように、`-T`の後ろにさらに指定することを意味します。

## メッセージを投稿する
メッセージを投稿するには、Slackのトークンと投稿するチャンネルとテキストを指定します。  
トークンは`-T`オプションで、チャンネルは`-c`オプションで指定します。また、個人へのダイレクトメッセージは`-d`オプションを指定します。  
チャンネル名やダイレクトメッセージのユーザ名には、`#`や`@` を付ける必要がありません。付けても動作しますが、`#`以降はコメント扱いとなるため、注意してください。

    # generalチャンネルに、「おはようございます」を送信する
    $ slackpost -T xxxx-xxxxxxxx -c general おはようございます

    # tanakaにダイレクトメッセージを送信する
    $ slackpost -T xxxx-xxxxxxxx -d tanaka こんにちは

## トークンと投稿するチャンネルのデフォルトを指定する
毎回同じチャンネルやユーザに投稿するのに、トークンとチャンネルを指定するのは面倒です。  
そのようなときは、環境変数`SLACK_TOKEN`にトークンを、`SLACK_CHANNEL`に投稿チャンネルを設定しておくことで、コマンド入力を省略することができます。  
*注意することとして、`SLACK_CHANNEL`にはチャンネルかダイレクトメッセージのどちらかを指定するため、`#`か`@`が必須となります。*  
毎回ログインするたびに環境変数を指定するのが面倒な場合は、`.bashrc`などに追加するといいでしょう。

    $ export SLACK_TOKEN=xxxx-xxxxxxxx
    $ export SLACK_CHANNEL=#genelral       # ここでは#や@が必須です

トークンとチャンネルのデフォルトを指定することで、コマンド入力は短くなります。  
また、他のトークンやチャンネルを指定した場合は、そちらを使用して投稿します。

    $ slackpost こんにちは            # デフォルトのトークンとチャンネルを使用
    $ slackpost -d tanaka おはよう    # チャンネルだけ別に指定
    $ slackpost -T yyyy-yyyyyyyy -c random さようなら  # トークンもチャンネルも別に指定

以降の説明は、コマンドを短くするために、デフォルトが指定されているものとして説明します。

## 送信テキストを標準入力から与える
送信テキストを指定しないでコマンドを実行した場合、標準入力からの文字列を送信テキストとして扱います。  
これにより、ファイルの中身やコマンドの結果、改行を含むキーボードからの入力を送信することができます。

    $ echo こんにちは > hello.txt   # 「こんにちは」と書かれたファイルを用意する
    $ cat hello.txt | slackpost    # hello.txtの中身をパイプを通して送信テキストに指定する
    
    $ slackpost
    こんにちは
    今日もいい天気ですね
    # 入力は Ctrl+D で終了。上の2行が送信される
    $

## 投稿者のユーザ名とアイコンを変更する
`-u`オプションを指定することで、ユーザ名を変更することができます。  
`-i`オプションを指定することで、アイコンを絵文字に指定することができます。  
`-I`オプションを指定することで、アイコンをURLの画像に指定することができます。  
名前やアイコンを別のユーザに合わせることで、簡単ななりすましができます。しかし、名前の横に`APP`と表示されるため、すぐにバレます。  
また、`-i`オプションで指定した絵文字が存在しない場合でもエラーが発生せず、アイコンの場所に指定した絵文字の名前が表示されます。

    $ slackpost -u DOG -i dog 僕は犬だよ           # 名前：DOG、アイコン：god
    $ slackpost -u 神 ユーザ名は日本語もできるよ      # ユーザ名：神
    $ slackpost -u DOG -I http://www..... Hello  # 画像のURLをアイコンに指定

## 投稿のテキストをスニペットとして指定する
`-s`オプションを指定することで、テキストをスニペットとして投稿することができます。`-s`オプションの後にファイルタイプを指定します。省略した場合は自動判別になります。  
`-n`オプションを指定することで、スニペットのファイル名を指定することができます。  
*スニペットとして指定した場合は送信の方法が異なるため、投稿者のユーザ名とアイコンはアカウントのものが使われ、`-u, -i, -I`オプションは無視されます。*

    $ cat test.py | slackpost -s python     # Pythonのスニペットとして送信
    $ cat test.c  | slackpost -s -n 練習問題 # タイプ自動判別＋ファイル名指定

## エラーについて
エラーが発生した場合は、標準エラー出力に出力します。  
よくあるエラーの場合は日本語で表示されるため、何を直せばいいかわかると思います。
